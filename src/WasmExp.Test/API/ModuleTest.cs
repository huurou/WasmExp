using System.IO;

namespace WasmExp.Test;

internal class ModuleTest
{
    [Test]
    public void InvokeTest()
    {
        /*
(module
  (func (export "addTwo") (param i32 i32) (result i32)
    local.get 0
    local.get 1
    i32.add))
         */
        var ms = new MemoryStream(new byte[]
        {
            0x00, 0x61, 0x73, 0x6D, 0x01, 0x00, 0x00, 0x00,
            0x01, 0x07, 0x01, 0x60, 0x02, 0x7F, 0x7F, 0x01,
            0x7F, 0x03, 0x02, 0x01, 0x00, 0x07, 0x0A, 0x01,
            0x06, 0x61, 0x64, 0x64, 0x54, 0x77, 0x6F, 0x00,
            0x00, 0x0A, 0x09, 0x01, 0x07, 0x00, 0x20, 0x00,
            0x20, 0x01, 0x6A, 0x0B, 0x00, 0x0A, 0x04, 0x6E,
            0x61, 0x6D, 0x65, 0x02, 0x03, 0x01, 0x00, 0x00,
        });
        var module = Wasm.Compile(ms);
        var instance = module.Instantiate();
        Assert.That(instance.Exports.addTwo(1, 2), Is.EqualTo(3));
    }
}